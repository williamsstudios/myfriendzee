<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%- title %></title>
    <link rel="stylesheet" href="/sass/bootstrap.min.css">
    <link rel="stylesheet" href="/sass/main.css">
    <link rel="icon" type="image/x-icon" href="/img/logos/favicon.ico">
    <script defer src="/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/81f3202402.js" crossorigin="anonymous"></script>
</head>
<body>
    <%- include('./inc/header.ejs') %>
    <div class="container" style="margin-top: 62px;">
        <div class="row">
            <div class="col-lg-12">
                <%- include('./inc/messages.ejs') %>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8 text-center">
                <img src="/uploads/<%- photo.user %>/<%- photo.filename %>" alt="<%- photo.user %>" width="500" style="margin: 100px;">
            </div>
            <div class="col-lg-4">
                <div class="card bg-light mt-3">
                    <div class="card-body">
                        <div class="row pb-3 border-bottom">
                            <div class="col-lg-2">
                                <a href="/users/<%- photoUser.username %>">
                                    <% if(photoUser.avatar) { %>
                                        <img src="/uploads/<%- photo.user %>/<%- photoUser.avatar %>" alt="<%- photo.user %>" width="50" height="50" class="rounded-circle">
                                    <% } else { %>
                                        <img src="/img/no_pic.jpg" alt="<%- photo.user %>" width="50" height="50" class="rounded-circle">
                                    <% } %>
                                </a>
                            </div>
                            <div class="col-lg-10">
                                <h5 class="card-title">
                                    <a href="/users/<%- photo.user %>" class="photoLink"><%- photoUser.firstname %> <%- photoUser.lastname %></a>
                                </h5>
                                <small class="text-muted"><%= photo.date_made.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) %> %></small>
                            </div>
                        </div>
                        <div class="row pt-3 pb-3 border-bottom">
                            <div class="col">
                                <p><%- photo.caption %></p>
                            </div>
                        </div>
                        <div class="row pt-3 pb-3 border-bottom">
                            <% if(logUser.username == photo.likes) { %>
                                <form method="POST" action="/photos/unlike/<%- photo._id %>">
                                    <div class="col">
                                        <button type="submit" class="btn btn-primary w-100"><i class="fa-solid fa-heart me-2"></i> Unlike</button>
                                    </div>               
                                </form>
                            <% } else if(logUser.username != photo.user) { %>
                                <form method="POST" action="/photos/like/<%- photo._id %>">
                                    <div class="col">
                                        <button type="submit" class="btn btn-outline-primary w-100"><i class="fa-regular fa-heart me-2"></i> Like</button>
                                    </div>     
                                </form>  
                            <% } %>
                            
                        </div>
                        <div class="row pt-3 pb-2 border-bottom">
                            <div class="col">
                                <h4 class="card-title text-dark">Comments</h4>
                            </div>
                        </div>
                        <div id="commentsContainer">
                            <% if(comments.length > 0) { %>
                                <% for(var c = 0; c<comments.length; c++) { %>
                                    <div class="row pt-3 pb-3 border-bottom" style="background: #EEE;">
                                        <div class="col-lg-2">
                                            <% if(comments[c].comments.avatar) { %>
                                                <a href="/users/<%- comments[c].user %>">
                                                    <img src="/uploads/<%- comments[c].user %>/<%- comments[c].comments.avatar %>" alt="<%- comments[c].user %>" width="60" height="60" class="rounded-circle">
                                                </a>
                                            <% } else { %>
                                                <a href="/users/<%- comments[c].user %>">
                                                    <img src="/img/no_pic.jpg>" alt="<%- comments[c].user %>" width="60" height="60" class="rounded-circle">
                                                </a>
                                            <% } %>
                                        </div>
                                        <div class="col-lg-10">
                                            <p class="text-dark">
                                                <b>
                                                    <a href="/users/<%- comments[c].user %>" style="text-decoration: none;"><%- comments[c].comments.firstname %> <%- comments[c].comments.lastname %></a>
                                                </b> 
                                                <br /> 
                                                <%- comments[c].data %> 
                                                <br /> 
                                                <% if(logUser.username == comments[c].likes) { %>
                                                    <form method="POST" action="/photos/unlike/<%- photo._id %>">
                                                        <div class="col">
                                                            <button type="submit" class="text-primary" style="background: none; border: 0px; box-shadow: none; outline: none;"><i class="fa-solid fa-heart me-2"></i> Unlike</button>
                                                        </div>               
                                                    </form>
                                                <% } else if(logUser.username != comments[c].user) { %>
                                                    <form method="POST" action="/photos/like/<%- photo._id %>">
                                                        <div class="col">
                                                            <button type="submit" class="text-dark" style="background: none; border: 0px; box-shadow: none; outline: none;"><i class="fa-regular fa-heart me-2"></i> Like</button>
                                                        </div>     
                                                    </form>  
                                                <% } %>
                                            </p>
                                        </div>
                                    </div>
                                <% } %>
                            <% } else { %>
                                <h5 clas="card-title">No Comments</h5>
                            <% } %>
                        </div>
                        <div class="row pt-3 pb-3">
                            <form method="POST" action="/photos/comment/<%- photo._id %>">
                                <div class="row">
                                    <div class="col-md-10">
                                        <textarea class="form-control-lg w-100" rows="1" cols="0" id="commentText" name="commentText" placeholder="Write a reply"></textarea>
                                    </div>
                                    <div class="col-md-1 p-0">
                                        <button type="submit" class="btn btn-light" style="font-size: 30px;"><i class="fa-solid fa-paper-plane"></i></button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js" integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y" crossorigin="anonymous"></script>
</body>
</html>

